(window.webpackJsonp=window.webpackJsonp||[]).push([[304],{612:function(t,a,n){"use strict";n.r(a);var s=n(25),e=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"location"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#location"}},[t._v("#")]),t._v(" location")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Syntax: location [ = | ~ | ~* | ^~ ] uri { ... }\n  location @name { ... }\nDefault: —\nContext: server, location\n")])])]),a("p",[t._v("优先级:")]),t._v(" "),a("ol",[a("li",[t._v("精确匹配(=)")]),t._v(" "),a("li",[t._v("特殊的最长前缀匹配(^~)")]),t._v(" "),a("li",[t._v("正则首次匹配（~*, ~）")]),t._v(" "),a("li",[t._v("最长前缀匹配")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("location "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" configuration A "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nlocation / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" configuration B "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nlocation /documents/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" configuration C "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nlocation ^~ /images/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" configuration D "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nlocation ~* "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gif"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("jpg"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("jpeg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" configuration E "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[t._v("/，匹配 A")]),t._v(" "),a("li",[t._v("/index.html，匹配B")]),t._v(" "),a("li",[t._v("/documents/document.html，匹配C")]),t._v(" "),a("li",[t._v("/images/1.gif，匹配D")]),t._v(" "),a("li",[t._v("/documents/1.jpg 匹配E")])]),t._v(" "),a("p",[t._v("以字符(/)结尾的loation，且有proxy_pass，需注意：")]),t._v(" "),a("ol",[a("li",[t._v("请求未以字符(/)结尾，除此外精确匹配uri，本次请求将301永久重定向到此uri(带/结尾的uri)")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("location /user/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n proxy_pass http://user.example.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[t._v("/user, 重定向 /user/")])]),t._v(" "),a("h1",{attrs:{id:"proxy-pass"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#proxy-pass"}},[t._v("#")]),t._v(" proxy_pass")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Syntax: proxy_pass URL;\nDefault: —\nContext: location, if in location, limit_except\n")])])]),a("blockquote",[a("p",[t._v("URL 包括协议(http、https)，地址(ip、域名 或者 端口)，或者 uri\nserver group的优先级高于域名")])]),t._v(" "),a("ul",[a("li",[t._v("proxy_pass有uri，匹配的uri完全被替换，使用URL的uri访问服务器")]),t._v(" "),a("li",[t._v("proxy_pass无uri，使用配匹的uri访问服务器")]),t._v(" "),a("li",[t._v("正则匹配的location，proxy_pass不能有uri")])]),t._v(" "),a("h1",{attrs:{id:"rewrite"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rewrite"}},[t._v("#")]),t._v(" rewrite")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Syntax: rewrite regex replacement [flag];\nDefault: —\nContext: server, location, if\n")])])]),a("blockquote",[a("p",[t._v("rewrite指令，按其在config中的位置，顺序执行，直到遇到特定的flag。\n如果replacement 是以 http,https,$scheme开头，则停止且重定向给client\n可选参数flag的值：")])]),t._v(" "),a("ol",[a("li",[t._v("last，停止当前的ngx_http_rewrite_module指令集，开始新的location匹配")]),t._v(" "),a("li",[t._v("break，停止当前的ngx_http_rewrite_module指令集，以break指令的方式（location中继续执行非此指令集）")]),t._v(" "),a("li",[t._v("redirect，302的临时重定向，用于 replacement 不以http、https、$scheme开头")]),t._v(" "),a("li",[t._v("permanent，301的永久重定向")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://v16m-default.akamaized.net/276f353e8102c02b9ecc107dddfffce0/66887c0d/video/tos/alisg/tos-alisg-v-0051c001-sg/oE0D2EADgVcB3nrFf5mNBhAuImd8fbIjuxHbRQ/?a=0&bti=cmd5ZGgxZGZiZmIrY2E6&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&br=1934&bt=967&cs=0&ds=3&ft=.cwOVInz7ThUyHPrXq8Zmo&mime_type=video_mp4&qs=13&rc=M2RpcXE5cnZoczMzODYzNEBpM2RpcXE5cnZoczMzODYzNEBkX2c2MmRjZ2tgLS1kMC1zYSNkX2c2MmRjZ2tgLS1kMC1zcw%3D%3D&vvpl=1&l=20240705165811902A76B3EBB87035DF7D&btag=e00060000",target:"_blank",rel:"noopener noreferrer"}},[a("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);